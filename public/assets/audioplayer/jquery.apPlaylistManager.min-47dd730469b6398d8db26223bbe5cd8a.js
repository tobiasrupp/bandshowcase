!function(t){function s(t){this._loopingOn=t.loopingOn,this._randomPlay=t.randomPlay,this._playlistItems,this._lastInOrder=!1,this._counter=-1,this._lastPlayedFromPlaylistClick,this._lastRandomCounter,this._randomPaused=!1,this._traceCounter=!1,this._randomArr=[],this._playlistSelect=!1}t.playlistManager=function(t){var i=new s(t);return i},s.prototype={setCounter:function(t,s){"undefined"==typeof s&&(s=!0),s?this._counter+=parseInt(t,10):this._counter=parseInt(t,10),this._checkCounter()},getCounter:function(){var t;return t=this._randomPlay?this._playlistSelect?this._counter:this._randomArr[this._counter]:this._counter},advanceHandler:function(t){this._playlistSelect=!1,this._randomPaused?this._handleRandomPaused(t):this.setCounter(t)},processPlaylistRequest:function(t){this._playlistSelect=!1,this._randomPlay&&(this._playlistSelect=!0,this._lastPlayedFromPlaylistClick=t,this._randomPaused||(this._lastRandomCounter=this._counter,this._randomPaused=!0)),this.setCounter(t,!1)},getLastInOrder:function(){return this._lastInOrder},getRandomPaused:function(){return this._randomPaused},setPlaylistItems:function(t,s){"undefined"==typeof s&&(s=!0),s&&(this._counter=-1),this._playlistItems=t,this._randomPlay&&this._makeRandomList()},reSetCounter:function(t){if("undefined"==typeof t)this._counter=-1;else{var s=parseInt(t,10);this._playlistItems?(s>this._playlistItems-1?s=this._playlistItems-1:0>s&&(s=0),this._counter=s):this._counter=-1}},setRandom:function(t){this._randomPlay=t,this._randomPlay&&this._makeRandomList(),this._randomChange()},setLooping:function(t){this._loopingOn=t},setTraceCounter:function(t){this._traceCounter=t},_handleRandomPaused:function(s){var i=t(this);return this._randomPaused=!1,this._lastRandomCounter+s>this._playlistItems-1?(this._counter=this._playlistItems-1,i.trigger("ap_PlaylistManager.COUNTER_READY"),void 0):this._lastRandomCounter+s<0?(this._counter=0,i.trigger("ap_PlaylistManager.COUNTER_READY"),void 0):(this.setCounter(this._lastRandomCounter+s,!1),void 0)},_randomChange:function(){this._randomPlay?(this._activeIndexFirst(),this._counter=0):this._randomPaused?(this._counter=this._lastPlayedFromPlaylistClick,this._randomPaused=!1):this._counter=this._randomArr[this._counter]},_checkCounter:function(){if(isNaN(this._counter))return alert("ap_PlaylistManager message: No active media, counter = "+this._counter),void 0;var s=t(this);this._lastInOrder=!1,this._loopingOn?(this._randomPlay?this._counter>this._playlistItems-1?(this._counter=this._randomArr[this._playlistItems-1],this._makeRandomList(),this._firstIndexCheck(),this._counter=0,s.trigger("ap_PlaylistManager.PLAYLIST_END_ALERT")):this._counter<0&&(this._counter=this._randomArr[0],this._makeRandomList(),this._lastIndexCheck(),this._counter=this._playlistItems-1):this._counter>this._playlistItems-1?(this._counter=0,s.trigger("ap_PlaylistManager.PLAYLIST_END_ALERT")):this._counter<0&&(this._counter=this._playlistItems-1),s.trigger("ap_PlaylistManager.COUNTER_READY")):(this._counter>this._playlistItems-1?(this._counter=this._playlistItems-1,this._lastInOrder=!0):this._counter<0&&(this._counter=0),this._lastInOrder?s.trigger("ap_PlaylistManager.PLAYLIST_END"):s.trigger("ap_PlaylistManager.COUNTER_READY")),this._traceCounter&&console.log("counter = "+this.getCounter())},_makeRandomList:function(){this._playlistItems<3||(this._randomArr=this._randomiseIndex(this._playlistItems))},_firstIndexCheck:function(){if(this._randomArr[0]==this._counter){var t=this._randomArr.splice(0,1);this._randomArr.push(t)}},_lastIndexCheck:function(){if(this._randomArr[this._playlistItems-1]==this._counter){var t=this._randomArr.splice(this._playlistItems-1,1);this._randomArr.unshift(t)}},_activeIndexFirst:function(){var t,s=0,i=this._randomArr.length;for(s;i>s;s++)if(this._randomArr[s]==this._counter){if(0==s)break;t=this._randomArr.splice(s,1),this._randomArr.unshift(parseInt(t,10));break}},_randomiseIndex:function(t){var s=[],i=[],n=0;for(n;t>n;n++)s[n]=n;var r,e=0;for(e;t>e;e++)r=Math.round(Math.random()*(s.length-1)),i[e]=s[r],s.splice(r,1);return i}}}(jQuery);